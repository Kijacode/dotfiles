var app=function(){"use strict";function t(){}const e=t=>t;function n(t,e){for(const n in e)t[n]=e[n];return t}function r(t){return t()}function o(){return Object.create(null)}function s(t){t.forEach(r)}function c(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function a(e,n,r){e.$$.on_destroy.push(function(e,...n){if(null==e)return t;const r=e.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}(n,r))}const u="undefined"!=typeof window;let l=u?()=>window.performance.now():()=>Date.now(),f=u?t=>requestAnimationFrame(t):t;const d=new Set;function h(t){d.forEach((e=>{e.c(t)||(d.delete(e),e.f())})),0!==d.size&&f(h)}function p(t,e){t.appendChild(e)}function g(t,e,n){t.insertBefore(e,n||null)}function m(t){t.parentNode.removeChild(t)}function y(t){return document.createElement(t)}function v(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function k(t){return document.createTextNode(t)}function w(){return k(" ")}function b(){return k("")}function x(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function $(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function C(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function _(t,e,n){t.classList[n?"add":"remove"](e)}let T;function E(t){T=t}function S(t){(function(){if(!T)throw new Error("Function called outside component initialization");return T})().$$.on_mount.push(t)}const j=[],M=[],L=[],A=[],z=Promise.resolve();let N=!1;function O(t){L.push(t)}let P=!1;const I=new Set;function U(){if(!P){P=!0;do{for(let t=0;t<j.length;t+=1){const e=j[t];E(e),B(e.$$)}for(E(null),j.length=0;M.length;)M.pop()();for(let t=0;t<L.length;t+=1){const e=L[t];I.has(e)||(I.add(e),e())}L.length=0}while(j.length);for(;A.length;)A.pop()();N=!1,P=!1,I.clear()}}function B(t){if(null!==t.fragment){t.update(),s(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(O)}}const D=new Set;let H;function q(t,e){t&&t.i&&(D.delete(t),t.i(e))}function F(t,e,n,r){if(t&&t.o){if(D.has(t))return;D.add(t),H.c.push((()=>{D.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}function V(t,e,n){const{fragment:o,on_mount:i,on_destroy:a,after_update:u}=t.$$;o&&o.m(e,n),O((()=>{const e=i.map(r).filter(c);a?a.push(...e):s(e),t.$$.on_mount=[]})),u.forEach(O)}function J(t,e){const n=t.$$;null!==n.fragment&&(s(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function G(t,e){-1===t.$$.dirty[0]&&(j.push(t),N||(N=!0,z.then(U)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function K(e,n,r,c,i,a,u=[-1]){const l=T;E(e);const f=n.props||{},d=e.$$={fragment:null,ctx:null,props:a,update:t,not_equal:i,bound:o(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(l?l.$$.context:[]),callbacks:o(),dirty:u,skip_bound:!1};let h=!1;if(d.ctx=r?r(e,f,((t,n,...r)=>{const o=r.length?r[0]:n;return d.ctx&&i(d.ctx[t],d.ctx[t]=o)&&(!d.skip_bound&&d.bound[t]&&d.bound[t](o),h&&G(e,t)),n})):[],d.update(),h=!0,s(d.before_update),d.fragment=!!c&&c(d.ctx),n.target){if(n.hydrate){const t=function(t){return Array.from(t.childNodes)}(n.target);d.fragment&&d.fragment.l(t),t.forEach(m)}else d.fragment&&d.fragment.c();n.intro&&q(e.$$.fragment),V(e,n.target,n.anchor),U()}E(l)}class Q{$destroy(){J(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const R=async(t,e)=>{try{const n=await fetch(apiBaseUrl+t,{method:"POST",body:JSON.stringify(e),headers:{"content-type":"application/json","access-token":accessToken,"refresh-token":refreshToken}});if(200!==n.status)throw new Error(await n.text());const r=n.headers.get("access-token"),o=n.headers.get("refresh-token");r&&o&&(accessToken=r,refreshToken=o,tsvscode.postMessage({type:"tokens",accessToken:r,refreshToken:o}));return await n.json()}catch(t){throw tsvscode.postMessage({type:"onError",value:t.message}),t}},W=t=>new Promise((e=>setTimeout(e,t))),X=(t,e)=>{for(const n of e)""===n.text?Z(t,n.range[0],n.range[1]):0===n.rangeLength?Y(t,n.range[0],n.text):tt(t,n.range[0],n.range[1],n.text)},Y=(t,e,n)=>{const r=n.split("\n"),o=t[e.line]||"";1!==r.length?t.splice(0,t.length,...t.slice(0,e.line-2),o.slice(0,e.character)+r[0],...r.slice(1,r.length-1),r[r.length-1]+o.slice(e.character),...t.slice(e.line+1)):t[e.line]=o.slice(0,e.character)+n+o.slice(e.character+1)},Z=(t,e,n)=>{const r=t[e.line]||"";e.line!==n.line?(t[e.line]=r.slice(0,e.character)+(t[n.line]||"").slice(n.character),t.splice(e.line+1,n.line-e.line)):t[e.line]=r.slice(0,e.character)+r.slice(n.character)},tt=(t,e,n,r)=>{Z(t,e,n),Y(t,e,r)},et=[];function nt(t){const e=t-1;return e*e*e+1}function rt(t){return"[object Date]"===Object.prototype.toString.call(t)}function ot(t,e){if(t===e||t!=t)return()=>t;const n=typeof t;if(n!==typeof e||Array.isArray(t)!==Array.isArray(e))throw new Error("Cannot interpolate values of different type");if(Array.isArray(t)){const n=e.map(((e,n)=>ot(t[n],e)));return t=>n.map((e=>e(t)))}if("object"===n){if(!t||!e)throw new Error("Object cannot be null");if(rt(t)&&rt(e)){t=t.getTime();const n=(e=e.getTime())-t;return e=>new Date(t+e*n)}const n=Object.keys(e),r={};return n.forEach((n=>{r[n]=ot(t[n],e[n])})),t=>{const e={};return n.forEach((n=>{e[n]=r[n](t)})),e}}if("number"===n){const n=e-t;return e=>t+e*n}throw new Error(`Cannot interpolate ${n} values`)}function st(r,o={}){const s=function(e,n=t){let r;const o=[];function s(t){if(i(e,t)&&(e=t,r)){const t=!et.length;for(let t=0;t<o.length;t+=1){const n=o[t];n[1](),et.push(n,e)}if(t){for(let t=0;t<et.length;t+=2)et[t][0](et[t+1]);et.length=0}}}return{set:s,update:function(t){s(t(e))},subscribe:function(c,i=t){const a=[c,i];return o.push(a),1===o.length&&(r=n(s)||t),c(e),()=>{const t=o.indexOf(a);-1!==t&&o.splice(t,1),0===o.length&&(r(),r=null)}}}}(r);let c,a=r;function u(t,i){if(null==r)return s.set(r=t),Promise.resolve();a=t;let u=c,p=!1,{delay:g=0,duration:m=400,easing:y=e,interpolate:v=ot}=n(n({},o),i);if(0===m)return u&&(u.abort(),u=null),s.set(r=a),Promise.resolve();const k=l()+g;let w;return c=function(t){let e;return 0===d.size&&f(h),{promise:new Promise((n=>{d.add(e={c:t,f:n})})),abort(){d.delete(e)}}}((e=>{if(e<k)return!0;p||(w=v(r,t),"function"==typeof m&&(m=m(r,t)),p=!0),u&&(u.abort(),u=null);const n=e-k;return n>m?(s.set(r=t),!1):(s.set(r=w(y(n/m))),!0)})),c.promise}return{set:u,update:(t,e)=>u(t(a,r),e),subscribe:s.subscribe}}function ct(t,e,n){const r=t.slice();return r[11]=e[n],r}function it(e){let n,r,o;return{c(){n=y("button"),n.textContent="replay"},m(t,s){g(t,n,s),r||(o=x(n,"click",e[8]),r=!0)},p:t,d(t){t&&m(n),r=!1,o()}}}function at(t){let e,n,r,o,s;function c(...e){return t[9](t[11],...e)}return{c(){e=y("button"),n=k(t[11]),r=k("x"),$(e,"class","plain-button svelte-1dzbhua"),_(e,"active",t[11]===t[2])},m(t,i){g(t,e,i),p(e,n),p(e,r),o||(s=x(e,"click",c),o=!0)},p(n,r){t=n,4&r&&_(e,"active",t[11]===t[2])},d(t){t&&m(e),o=!1,s()}}}function ut(e){let n,r,o,s,c,i,a,u,l,f=e[0].join("\n")+"",d="done"===e[3]&&it(e),h=[.5,1,2,3],v=[];for(let t=0;t<4;t+=1)v[t]=at(ct(e,h,t));return{c(){d&&d.c(),n=w(),r=y("div"),o=y("div"),o.textContent="Change speed:",s=w();for(let t=0;t<4;t+=1)v[t].c();c=w(),i=y("progress"),a=w(),u=y("pre"),l=k(f),$(r,"class","row svelte-1dzbhua"),i.value=e[4],$(i,"class","svelte-1dzbhua")},m(t,e){d&&d.m(t,e),g(t,n,e),g(t,r,e),p(r,o),p(r,s);for(let t=0;t<4;t+=1)v[t].m(r,null);g(t,c,e),g(t,i,e),g(t,a,e),g(t,u,e),p(u,l)},p(t,[e]){if("done"===t[3]?d?d.p(t,e):(d=it(t),d.c(),d.m(n.parentNode,n)):d&&(d.d(1),d=null),4&e){let n;for(h=[.5,1,2,3],n=0;n<4;n+=1){const o=ct(t,h,n);v[n]?v[n].p(o,e):(v[n]=at(o),v[n].c(),v[n].m(r,null))}for(;n<4;n+=1)v[n].d(1)}16&e&&(i.value=t[4]),1&e&&f!==(f=t[0].join("\n")+"")&&C(l,f)},i:t,o:t,d(t){d&&d.d(t),t&&m(n),t&&m(r),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(v,t),t&&m(c),t&&m(i),t&&m(a),t&&m(u)}}}function lt(t,e,n){let r;var o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,s){function c(t){try{a(r.next(t))}catch(t){s(t)}}function i(t){try{a(r.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,i)}a((r=r.apply(t,e||[])).next())}))};let s=1,{startingChunks:c}=e,{textChunks:i}=e,{recordingSteps:u}=e,l=u&&u.length?"running":"static";const f=st(0,{duration:100,easing:nt});a(t,f,(t=>n(4,r=t)));const d=()=>o(void 0,void 0,void 0,(function*(){if(!u||!u.length)return f.set(1),void n(3,l="done");n(3,l="running");const t=(new Date).getTime(),e=u[u.length-1][0];let r=0;for(;r<u.length;){const[o,c]=u[r],a=((new Date).getTime()-t)*s;a<o?(f.set(a/e),yield W(10)):(X(i,c),n(0,i),r++)}f.set(1),n(3,l="done")}));S((()=>o(void 0,void 0,void 0,(function*(){yield d()}))));return t.$$set=t=>{"startingChunks"in t&&n(1,c=t.startingChunks),"textChunks"in t&&n(0,i=t.textChunks),"recordingSteps"in t&&n(7,u=t.recordingSteps)},[i,c,s,l,r,f,d,u,()=>{n(0,i=[...c]),f.set(0),d()},t=>{n(2,s=t)}]}class ft extends Q{constructor(t){super(),K(this,t,lt,ut,i,{startingChunks:1,textChunks:0,recordingSteps:7})}}function dt(t){let e,n,r,o,s,c=t[1].numLikes.toLocaleString()+"";function i(t,e){return t[1].hasLiked?ht:pt}let a=i(t),u=a(t),l=(currentUserId===t[1].creatorId||"dac7eb0f-808b-4842-b193-5d68cc082609"===currentUserId)&&gt(t);return{c(){u.c(),e=w(),n=y("div"),r=k(c),o=w(),l&&l.c(),s=b(),$(n,"class","likes svelte-skutac")},m(t,c){u.m(t,c),g(t,e,c),g(t,n,c),p(n,r),g(t,o,c),l&&l.m(t,c),g(t,s,c)},p(t,n){a===(a=i(t))&&u?u.p(t,n):(u.d(1),u=a(t),u&&(u.c(),u.m(e.parentNode,e))),2&n&&c!==(c=t[1].numLikes.toLocaleString()+"")&&C(r,c),currentUserId===t[1].creatorId||"dac7eb0f-808b-4842-b193-5d68cc082609"===currentUserId?l?l.p(t,n):(l=gt(t),l.c(),l.m(s.parentNode,s)):l&&(l.d(1),l=null)},d(t){u.d(t),t&&m(e),t&&m(n),t&&m(o),l&&l.d(t),t&&m(s)}}}function ht(e){let n,r,o,s,c;return{c(){n=v("svg"),r=v("g"),o=v("path"),$(o,"d","M12 21.638h-.014C9.403 21.59 1.95 14.856 1.95 8.478c0-3.064 2.525-5.754 5.403-5.754 2.29 0 3.83 1.58 4.646 2.73.814-1.148 2.354-2.73 4.645-2.73 2.88 0 5.404 2.69 5.404 5.755 0 6.376-7.454 13.11-10.037 13.157H12z"),$(n,"viewBox","0 0 24 24"),$(n,"fill","rgb(224, 36, 94)"),$(n,"class","heart svelte-skutac")},m(t,i){g(t,n,i),p(n,r),p(r,o),s||(c=x(n,"click",e[4]),s=!0)},p:t,d(t){t&&m(n),s=!1,c()}}}function pt(e){let n,r,o,s,c;return{c(){n=v("svg"),r=v("g"),o=v("path"),$(o,"d","M12 21.638h-.014C9.403 21.59 1.95 14.856 1.95 8.478c0-3.064 2.525-5.754 5.403-5.754 2.29 0 3.83 1.58 4.646 2.73.814-1.148 2.354-2.73 4.645-2.73 2.88 0 5.404 2.69 5.404 5.755 0 6.376-7.454 13.11-10.037 13.157H12zM7.354 4.225c-2.08 0-3.903 1.988-3.903 4.255 0 5.74 7.034 11.596 8.55 11.658 1.518-.062 8.55-5.917 8.55-11.658 0-2.267-1.823-4.255-3.903-4.255-2.528 0-3.94 2.936-3.952 2.965-.23.562-1.156.562-1.387 0-.014-.03-1.425-2.965-3.954-2.965z"),$(n,"viewBox","0 0 24 24"),$(n,"fill","#fff"),$(n,"class","heart svelte-skutac")},m(t,i){g(t,n,i),p(n,r),p(r,o),s||(c=x(n,"click",e[3]),s=!0)},p:t,d(t){t&&m(n),s=!1,c()}}}function gt(e){let n,r,o,s,c,i,a;return{c(){n=v("svg"),r=v("polyline"),o=v("path"),s=v("line"),c=v("line"),$(r,"points","3 6 5 6 21 6"),$(o,"d","M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"),$(s,"x1","10"),$(s,"y1","11"),$(s,"x2","10"),$(s,"y2","17"),$(c,"x1","14"),$(c,"y1","11"),$(c,"x2","14"),$(c,"y2","17"),$(n,"class","trash svelte-skutac"),$(n,"width","18"),$(n,"height","18"),$(n,"viewBox","0 0 24 24"),$(n,"fill","none"),$(n,"stroke","#fff"),$(n,"stroke-width","2"),$(n,"stroke-linecap","round"),$(n,"stroke-linejoin","round")},m(t,u){g(t,n,u),p(n,r),p(n,o),p(n,s),p(n,c),i||(a=x(n,"click",e[5]),i=!0)},p:t,d(t){t&&m(n),i=!1,a()}}}function mt(e){let n;return{c(){n=y("p"),n.textContent="could not find story"},m(t,e){g(t,n,e)},p:t,i:t,o:t,d(t){t&&m(n)}}}function yt(t){let e,n;return e=new ft({props:{startingChunks:t[1].text.split("\n"),textChunks:t[1].text.split("\n"),recordingSteps:t[1].recordingSteps}}),{c(){var t;(t=e.$$.fragment)&&t.c()},m(t,r){V(e,t,r),n=!0},p(t,n){const r={};2&n&&(r.startingChunks=t[1].text.split("\n")),2&n&&(r.textChunks=t[1].text.split("\n")),2&n&&(r.recordingSteps=t[1].recordingSteps),e.$set(r)},i(t){n||(q(e.$$.fragment,t),n=!0)},o(t){F(e.$$.fragment,t),n=!1},d(t){J(e,t)}}}function vt(e){let n,r,o=e[2].message+"";return{c(){var t,e,s;n=y("p"),r=k(o),t="color",e="red",n.style.setProperty(t,e,s?"important":"")},m(t,e){g(t,n,e),p(n,r)},p(t,e){4&e&&o!==(o=t[2].message+"")&&C(r,o)},i:t,o:t,d(t){t&&m(n)}}}function kt(e){let n;return{c(){n=y("p"),n.textContent="loading..."},m(t,e){g(t,n,e)},p:t,i:t,o:t,d(t){t&&m(n)}}}function wt(e){let n,r,o,c,i,a,u,l,f,d,h,v,k,x=story.flair in flairMap&&function(e){let n,r;return{c(){n=y("img"),$(n,"class","flair svelte-skutac"),n.src!==(r=flairMap[story.flair])&&$(n,"src",r)},m(t,e){g(t,n,e)},p:t,d(t){t&&m(n)}}}(),C=e[1]&&dt(e);const _=[kt,vt,yt,mt],T=[];function E(t,e){return t[0]?0:t[2]?1:t[1]?2:3}return d=E(e),h=T[d]=_[d](e),{c(){n=y("div"),r=y("img"),c=w(),i=y("div"),a=y("div"),a.textContent=""+story.creatorUsername.slice(0,30),u=w(),x&&x.c(),l=w(),C&&C.c(),f=w(),h.c(),v=b(),$(r,"alt","avatar"),$(r,"class","pic svelte-skutac"),r.src!==(o=story.creatorAvatarUrl)&&$(r,"src",o),$(a,"class","username"),$(i,"class","username-and-flair svelte-skutac"),$(n,"class","top svelte-skutac")},m(t,e){g(t,n,e),p(n,r),p(n,c),p(n,i),p(i,a),p(i,u),x&&x.m(i,null),p(n,l),C&&C.m(n,null),g(t,f,e),T[d].m(t,e),g(t,v,e),k=!0},p(t,[e]){story.flair in flairMap&&x.p(t,e),t[1]?C?C.p(t,e):(C=dt(t),C.c(),C.m(n,null)):C&&(C.d(1),C=null);let r=d;d=E(t),d===r?T[d].p(t,e):(H={r:0,c:[],p:H},F(T[r],1,1,(()=>{T[r]=null})),H.r||s(H.c),H=H.p,h=T[d],h||(h=T[d]=_[d](t),h.c()),q(h,1),h.m(v.parentNode,v))},i(t){k||(q(h),k=!0)},o(t){F(h),k=!1},d(t){t&&m(n),x&&x.d(),C&&C.d(),t&&m(f),T[d].d(t),t&&m(v)}}}function bt(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,s){function c(t){try{a(r.next(t))}catch(t){s(t)}}function i(t){try{a(r.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,i)}a((r=r.apply(t,e||[])).next())}))};let o=!0,s=null,c=null;S((()=>r(void 0,void 0,void 0,(function*(){try{const t=yield(async t=>{try{const e=await fetch(apiBaseUrl+t,{headers:{"access-token":accessToken,"refresh-token":refreshToken}});if(200!==e.status)throw new Error(await e.text());const n=e.headers.get("access-token"),r=e.headers.get("refresh-token");return n&&r&&(accessToken=n,refreshToken=r,tsvscode.postMessage({type:"tokens",accessToken:n,refreshToken:r})),await e.json()}catch(t){throw tsvscode.postMessage({type:"onError",value:t.message}),t}})("/text-story/"+story.id);n(1,s=t.story)}catch(t){n(2,c=t)}n(0,o=!1)}))));return[o,s,c,async()=>{try{await R("/like-text-story/"+s.id,{}),n(1,s.hasLiked=!0,s),n(1,s.numLikes++,s)}catch{}},async()=>{try{await R("/unlike-text-story/"+s.id,{}),n(1,s.hasLiked=!1,s),n(1,s.numLikes--,s)}catch{}},async()=>{try{await R("/delete-text-story/"+s.id,{}),tsvscode.postMessage({type:"close"}),tsvscode.postMessage({type:"onInfo",value:"Delete successful, but the story is still showing because I'm too lazy to clear the cache atm"})}catch{}}]}return new class extends Q{constructor(t){super(),K(this,t,bt,wt,i,{})}}({target:document.body})}();
//# sourceMappingURL=view-story.js.map
